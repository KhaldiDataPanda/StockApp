<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'">
    <title>Stock Reconciliation - El Fath</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3h18v18H3zM9 3v18M15 3v18M3 9h18M3 15h18"/>
                    </svg>
                    <span class="logo-text">Stock Reconciliation</span>
                </div>
                <nav class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item active">Select Unit</span>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page 1: Unit Selection -->
            <section id="page-unit-selection" class="page active">
                <div class="page-header">
                    <h1>Select Unit</h1>
                    <p class="page-subtitle">Choose the unit you want to process stock reconciliation for</p>
                </div>
                <div class="units-grid">
                    <div class="unit-card" data-unit="Fath1">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Fath 1</h3>
                        <p class="unit-info">18 Ateliers</p>
                    </div>
                    <div class="unit-card" data-unit="Fath2">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Fath 2</h3>
                        <p class="unit-info">10 Ateliers</p>
                    </div>
                    <div class="unit-card" data-unit="Fath5">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Fath 5</h3>
                        <p class="unit-info">14 Ateliers</p>
                    </div>
                    <div class="unit-card" data-unit="Larbaa">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Larbaa</h3>
                        <p class="unit-info">17 Ateliers</p>
                    </div>
                    <div class="unit-card" data-unit="Oran">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Oran</h3>
                        <p class="unit-info">4 Ateliers</p>
                    </div>
                    <div class="unit-card" data-unit="Fibre">
                        <div class="unit-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18M9 21V9"/>
                            </svg>
                        </div>
                        <h3>Fibre</h3>
                        <p class="unit-info">7 Ateliers</p>
                    </div>
                </div>
            </section>

            <!-- Page 2: File Upload & Matching -->
            <section id="page-file-upload" class="page">
                <div class="page-header">
                    <button class="btn-back" id="btn-back-to-units">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Back
                    </button>
                    <div>
                        <h1>Upload Files - <span id="selected-unit-name"></span></h1>
                        <p class="page-subtitle">Drag & drop your files or click to browse</p>
                    </div>
                </div>

                <!-- Month Selection -->
                <div class="month-selector">
                    <label for="month-select">Select Month:</label>
                    <select id="month-select">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12" selected>December</option>
                    </select>
                </div>

                <!-- Drop Zone -->
                <div class="drop-zone" id="drop-zone">
                    <div class="drop-zone-content">
                        <svg class="drop-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <p class="drop-text">Drag & drop Excel files here</p>
                        <p class="drop-subtext">or click to browse</p>
                        <input type="file" id="file-input" multiple accept=".xlsx,.xls,.csv" hidden>
                    </div>
                </div>

                <!-- Stock File Section -->
                <div class="stock-section">
                    <div class="section-header">
                        <h3>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Stock File
                        </h3>
                        <span class="status-badge" id="stock-status">Not Loaded</span>
                    </div>
                    <div class="stock-file-display" id="stock-file-display">
                        <p class="placeholder-text">No stock file detected. The system will look for "STOCK" in filename.</p>
                    </div>
                </div>

                <!-- File Matching Section -->
                <div class="matching-section">
                    <div class="matching-columns">
                        <!-- Ateliers Column -->
                        <div class="column ateliers-column">
                            <div class="column-header">
                                <h3>Ateliers</h3>
                                <span class="count-badge" id="matched-count">0 matched</span>
                            </div>
                            <div class="ateliers-list" id="ateliers-list">
                                <!-- Populated dynamically -->
                            </div>
                        </div>

                        <!-- Unmatched Files Column -->
                        <div class="column unmatched-column">
                            <div class="column-header">
                                <h3>Unmatched Files</h3>
                                <span class="count-badge warning" id="unmatched-count">0 files</span>
                            </div>
                            <div class="unmatched-list" id="unmatched-list">
                                <p class="placeholder-text">Files that couldn't be matched will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-bar">
                    <button class="btn btn-secondary" id="btn-clear-files">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Clear All
                    </button>
                    <button class="btn btn-primary" id="btn-process" disabled>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        Process Files
                    </button>
                </div>
            </section>

            <!-- Page 3: Processing -->
            <section id="page-processing" class="page">
                <div class="processing-container">
                    <div class="processing-spinner"></div>
                    <h2>Processing Files...</h2>
                    <p id="processing-status">Initializing...</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </section>

            <!-- Page 4: Results -->
            <section id="page-results" class="page">
                <div class="page-header">
                    <button class="btn-back" id="btn-back-to-upload">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                        Back
                    </button>
                    <div>
                        <h1>Results</h1>
                        <p class="page-subtitle">Review matches and discrepancies</p>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card success">
                        <div class="summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                <polyline points="22,4 12,14.01 9,11.01"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-value" id="total-matches">0</span>
                            <span class="summary-label">Total Matches</span>
                        </div>
                    </div>
                    <div class="summary-card warning">
                        <div class="summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-value" id="total-discrepancies">0</span>
                            <span class="summary-label">Total Discrepancies</span>
                        </div>
                    </div>
                    <div class="summary-card info">
                        <div class="summary-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <path d="M3 9h18"/>
                            </svg>
                        </div>
                        <div class="summary-info">
                            <span class="summary-value" id="total-ateliers">0</span>
                            <span class="summary-label">Ateliers Processed</span>
                        </div>
                    </div>
                </div>

                <!-- Results Filter -->
                <div class="results-filter">
                    <div class="filter-group">
                        <label>Atelier:</label>
                        <select id="atelier-select">
                            <option value="">Select an atelier...</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>View:</label>
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-view="matches">Matches</button>
                            <button class="toggle-btn" data-view="discrepancies">Discrepancies</button>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="btn-export">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export CSV
                    </button>
                </div>

                <!-- Results Table -->
                <div class="results-table-container">
                    <table class="results-table" id="results-table">
                        <thead>
                            <tr>
                                <th>Reference</th>
                                <th>Stock Qty</th>
                                <th>Movement Qty</th>
                                <th>Difference</th>
                            </tr>
                        </thead>
                        <tbody id="results-tbody">
                            <tr class="empty-row">
                                <td colspan="4">Select an atelier to view results</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- New Process Button -->
                <div class="action-bar">
                    <button class="btn btn-primary" id="btn-new-process">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        New Process
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="scripts/app.js"></script>
</body>
</html>
